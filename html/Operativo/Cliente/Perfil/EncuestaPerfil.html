<div ng-controller="EncuestaPerfilControlador as encuestaPControlador" ng-init="GetCatalagos()">
    
    <br>
    <!-- Aplicar nueva encuesta -->
    <div class="row"  ng-show="permiso.aplicar"> 
        <div class="col-xs-12">
           
            <button class="btn botonAgregarAcordion pull-right" ng-click="AplicarNuevaEncuesta()" >
                <span>
                    <span class="fa fa-plus"></span>
                    <span> Nueva Encuesta</span> 
                </span>
            </button>
        </div>
    </div>
    
    <!-- Encuestas Sugeridas -->
    <div class="row"  style="margin-top: 8px" ng-show="permiso.ver">
        <div class="col-xs-12">
            <button class="btn btn-block botonAcordionPerfil" ng-class="{active : tabSeleccionada == 'Sugerida'}" ng-click="CambiarTab('Sugerida')">
                <span class="fa fa-chevron-right" style="width:20px;" ng-if="tabSeleccionada != 'Sugerida'"></span>
                <span class="fa fa-chevron-up" style="width:20px;" ng-if="tabSeleccionada == 'Sugerida'"></span>
                Encuestas Sugeridas
            </button>
        </div>
    </div>
    
    <div ng-show=" tabSeleccionada == 'Sugerida'">
       
        
        <!-- última encuesta -->
        <div class="row" ng-show="encuesta.length > 0">
            <div class="col-xs-12">
                <div class="pull-right">
                   
                    <div class="textoInfo">
                        <b>Última encuesta aplicada: </b>
                        <span> {{ encuesta[0].UltimaEncuesta | fechaEsp }}</span>
                    </div>
                </div>
            </div>
        </div>
        <br>
        
        <div class="row" >
      
            <!-- Motivo Encuesta (tipo encuesta) -->
            <div class="col-sm-6" >

              <label>Motivo Encuesta</label>
              <div class="dropdown">

                    <button class="dropdown-toggle  dropdownlistModal" data-toggle="dropdown" style="height: 33px">
                       {{filtro.tipoEncuesta.Nombre}}
                        <span class="pull-right">
                            <span class="caret "></span>
                        </span>
                    </button>

                    <ul class="dropdown-menu listaOpcionesDropdownList" style="min-width: 100%">
                        <li>
                           <a  href="" class="dropdownOpcionModal" ng-click="CambiarTipoEncuesta('ninguno')">
                                <span>NINGUNO</span>
                            </a>
                        </li>

                        <li ng-repeat="tipo in tipoEncuesta">
                            <a  href="" class="dropdownOpcionModal" ng-click="CambiarTipoEncuesta(tipo)">
                                <span>{{tipo.Nombre}}</span>
                            </a>
                        </li>
                    </ul>

                </div>

            </div>
            
            <!-- Estatus Encuesta -->
            <div class="col-sm-6" >

              <label>Estatus</label>
              <div class="dropdown">

                    <button class="dropdown-toggle  dropdownlistModal" data-toggle="dropdown" style="height: 33px">
                       {{filtro.estatusEncuesta.Nombre}}
                        <span class="pull-right">
                            <span class="caret "></span>
                        </span>
                    </button>

                    <ul class="dropdown-menu listaOpcionesDropdownList" style="min-width: 100%">
                        <li>
                           <a  href="" class="dropdownOpcionModal" ng-click="CambiarEstatusEncuesta('ninguno')">
                                <span>NINGUNO</span>
                            </a>
                        </li>

                        <li ng-repeat="estatus in estatusEncuestaSugerida">
                            <a  href="" class="dropdownOpcionModal" ng-click="CambiarEstatusEncuesta(estatus)">
                                <span>{{estatus.Nombre}}</span>
                            </a>
                        </li>
                    </ul>

                </div>

            </div>
        
        </div>
        <br>
        
        
        <!-- tabla de encuestas sugeridas -->
        <div class="row" ng-show="(encuesta | filter:FiltroEncuestaSugerida).length > 0">
           <div class="col-xs-12" >
               <div class="table-responsive " style="overflow: scroll; max-height: 650px;">
                <table class="table table-hover table-striped" >
                    <thead class="TituloTabla" style="background: lightgray; border-color: lightgray; color:black !important">
                      <tr>
                    
                        <th>
                            <button class="btn botonOrdenar" ng-click="CambiarOrdenar('NombreTipoEncuesta')" style="padding:  0px; color: black">
                                <b>Motivo</b> <span ng-class="{'fa fa-arrow-up': ordenar == 'NombreTipoEncuesta', 'fa fa-arrow-down': ordenar == '-NombreTipoEncuesta'}"></span>
                            </button>
                        </th> 
                            
                        <th class="text-center"><span class=""><b>Detalle Motivo</b></span></th>
 

                        <th class="text-center">
                            <button class="btn botonOrdenar" ng-click="CambiarOrdenar('UltimoMovimiento')" style="padding:  0px; text-align: center !important; color:black">
                                <b>Último Movimiento</b> <span ng-class="{'fa fa-arrow-up': ordenar == 'UltimoMovimiento', 'fa fa-arrow-down': ordenar == '-UltimoMovimiento'}"></span>
                            </button>
                        </th>

                        <th>
                            <button class="btn botonOrdenar" ng-click="CambiarOrdenar('NombreEstatusEncuestaSugerida')" style="padding:  0px; color:black">
                                <b>Estatus</b> <span ng-class="{'fa fa-arrow-up': ordenar == 'NombreEstatusEncuestaSugerida', 'fa fa-arrow-down': ordenar == '-NombreEstatusEncuestaSugerida'}"></span>
                            </button>
                        </th> 


                        <th><span class=""><b></b></span></th>

                      </tr>
                    </thead>
                    <tbody > 
                        <tr ng-repeat="encuesta in encuesta | filter:FiltroEncuestaSugerida | orderBy:[ordenar, '-UltimoMovimiento']">

                            <td >
                                <span ng-class="{textoVerde: encuesta.TipoEncuestaId == '1', textoRojo: encuesta.TipoEncuestaId == '2'}">{{encuesta.NombreTipoEncuesta}}</span>
                            </td>

                           <td class="text-center">

                               <div class="dropdown" ng-show="encuesta.Motivo.length > 0" >
                                   <a class="BotonOperacion dropdown-toggle " style="font-size: 11pt; padding: 0px; background: transparent" data-toggle="dropdown" >
                                       <span class="fa fa-eye  fa-2x"></span>
                                    </a>

                                    <ul class="dropdown-menu dropdown-menu-right dropdownRight" style="margin-top: 5px; width: auto;">
                                        <form style="padding: 0px 10px">

                                           <b>
                                               {{encuesta.TipoEncuestaId == '1' ? 'Contratos' : encuesta.TipoEncuestaId == '2' ? 'Proyectos' : ''}}
                                           </b>

                                            <div class="table-responsive">
                                                <table class="table table-hover table-striped table-condensed" style="margin-bottom: 0px">
                                                    <thead class="TituloTabla" >
                                                        <tr>
                                                            <th style="min-width: 120px">
                                                                {{encuesta.TipoEncuestaId == '1' ? '#' : encuesta.TipoEncuestaId == '2' ? 'Tipo' : ''}}
                                                            </th>
                                                            <th style="min-width: 120px">
                                                                {{encuesta.TipoEncuestaId == '1' ? 'Nombre' : encuesta.TipoEncuestaId == '2' ? 'Nombre' : ''}}
                                                            </th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr ng-repeat="motivo in encuesta.Motivo track by $index">
                                                            <td ng-show="encuesta.TipoEncuestaId == '1'">{{motivo.ContratoId}} </td>
                                                            <td ng-show="encuesta.TipoEncuestaId == '1'">{{motivo.ProyectoNombre}} </td>

                                                            <td ng-show="encuesta.TipoEncuestaId == '2'">{{motivo.NombreTipoProyecto}} </td>
                                                            <td ng-show="encuesta.TipoEncuestaId == '2'">{{motivo.NombreProyecto}} </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </form>
                                    </ul>
                                 </div>

                               <span ng-if="encuesta.Motivo.length == 0" class="fa fa-eye fa-2x botonRegistroDeshabilitado"></span>
                            </td>


                            <td class="text-center">{{encuesta.UltimoMovimiento | fechaEsp}}</td>

                            <td>
                                <b ng-class="{textoNaranja: encuesta.EstatusEncuestaSugeridaId == '1', textoVerde: encuesta.EstatusEncuestaSugeridaId == '2', textoRojo: encuesta.EstatusEncuestaSugeridaId == '3'}">
                                    {{encuesta.NombreEstatusEncuestaSugerida}}
                                </b>
                            </td>

                            <td class="">
                               <div class="dropdown">
                                   <button class="botonAgregarAcordion dropdown-toggle " style="font-size: 11pt; padding: 0px; background: transparent; width: 20px" data-toggle="dropdown" >
                                       <span class="fa fa-ellipsis-v"></span>
                                    </button>

                                    <ul class="dropdown-menu dropdown-menu-right dropdownRight" style="margin-top: 5px; width: auto">
                                        <li ng-show="encuesta.EstatusEncuestaSugeridaId == '1' && permiso.aplicar">
                                            <a class="dropdownOpcionModal" ng-click="AplicarEncuesta(encuesta)">
                                                <span class="fa fa-check"></span> Aplicar Encuesta 
                                            </a>
                                        </li>

                                        <li ng-show="encuesta.EstatusEncuestaSugeridaId == '1' && permiso.aplicar" >
                                            <a class="dropdownOpcionModal" ng-click="RechazarEncuesta(encuesta)">
                                                <span class="fa fa-times"></span> Rechazar Encuesta
                                            </a>
                                        </li>

                                        <li ng-show="encuesta.EstatusEncuestaSugeridaId != '1'">
                                            <a class="dropdownOpcionModal" ng-click="DetalleEncuesta(encuesta)">
                                                <span class="fa fa-eye"></span> Detalle
                                            </a>
                                        </li>

                                    </ul>
                                 </div>

                            </td>


                        </tr>

                    </tbody>
               </table>
               </div>
            </div>
       </div>

       <div class="row" ng-if="(encuesta | filter:FiltroEncuestaSugerida).length == 0">
           <div class="col-xs-12">
               <div  class="textoPerfilHome">
                    <span>Sin datos encontrados.</span>
               </div>
           </div>
           
           <div class="col-xs-12" style="margin-top: 15px"></div>
       </div>
        
    </div>
    
    <!-- Encuestas Aplicadas -->
    <div class="row" style="margin-top: 8px">
        <div class="col-xs-12">
            <button class="btn btn-block botonAcordionPerfil" ng-class="{active : tabSeleccionada == 'Aplicada'}" ng-click="CambiarTab('Aplicada')">
                <span class="fa fa-chevron-right" style="width:20px;" ng-if="tabSeleccionada != 'Aplicada'"></span>
                <span class="fa fa-chevron-up" style="width:20px;" ng-if="tabSeleccionada == 'Aplicada'"></span>
                Encuestas Aplicadas
            </button>
        </div>
    </div>
    
    <div ng-show="tabSeleccionada == 'Aplicada'">
        <br>
        <!-- tabla de encuestas aplicadas -->
        <div class="row" ng-show="encuestaAplicada.length > 0">
           <div class="col-xs-12" >
               <div class="table-responsive " style="overflow: scroll; max-height: 650px;">
                <table class="table table-hover table-striped" >
                    <thead class="TituloTabla" style="background: lightgray; border-color: lightgray; color:black !important">
                      <tr>
                            
                        <th ><span><b>Encuesta</b></span></th>
                        <th class="text-center"><span><b>Fecha</b></span></th>
                        <th ><span><b>Aplicó</b></span></th>
                        <th class="text-center"><span><b>Detalle </b></span></th>

                      </tr>
                    </thead>
                    <tbody > 
                        <tr ng-repeat="encuesta in encuestaAplicada | orderBy:['-Fecha', 'NombreEncuesta']">
                            <td>{{encuesta.NombreEncuesta}}</td>
                            <td class="text-center">{{encuesta.Fecha | fechaEsp}}</td>
                            <td>{{encuesta.Colaborador}}</td>
                            <td class="text-center">
                                <a class="BotonOperacion" style="font-size: 11pt; padding: 0px; background: transparent" ng-click="DetalleEncuestaAplicada(encuesta)">
                                   <span class="fa fa-eye  fa-2x"></span>
                                </a>

                            </td>
                        </tr>

                    </tbody>
               </table>
               </div>
            </div>
       </div>

       <div class="row" ng-if="encuestaAplicada.length == 0">
           <div class="col-xs-12">
               <div  class="textoPerfilHome">
                    <span>El cliente aún no ha contestado ninguna encuesta.</span>
               </div>
           </div>
       </div>
        
    </div>
    
    
    <!-- --------------------- Modales -------------------- -->
    <!-- Motivo rechazo encuesta -->
    <div class="modal fade sombraDivModal" id="MotivoRechazoPerfil" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <br>    <br>   
        <div class="modal-dialog modalPrincipal modal-sm">
            <div class="row">
                <div class="col-xs-12" style="font-size:12pt">
                    <b>Motivo de la encuesta rechazada</b><br><br>
                   {{motivoRechazoDetalle}}
                </div>
            </div>
            <br><br>
            <div class="row">
            
                <div class="col-xs-12" >
                   <div class="text-center">
                    <button focus class="btn botonOperacionModal btn-block" data-dismiss="modal" aria-label="Close">Aceptar</button>
                   </div>
                </div>
            </div>
        </div>   
    </div>
    
    
    
</div>

     